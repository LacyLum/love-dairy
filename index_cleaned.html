
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æˆ‘ä»¬çš„æ‹çˆ±æ—¥è®°</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #fff0f5; margin: 0; padding: 0; text-align: center; }
    h1 { background: pink; padding: 20px; margin: 0; }
    section { margin: 20px auto; max-width: 800px; padding: 10px; }
    .photo-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px; }
    .photo-grid img { width: 100%; border-radius: 8px; cursor: pointer; }
    .msg { background: white; border-radius: 8px; padding: 10px; margin: 10px 0; box-shadow: 0 1px 3px rgba(0,0,0,0.1); text-align: left; }
    iframe { width: 100%; height: 200px; border: none; border-radius: 10px; margin-top: 15px; }
    button, input, textarea { font-family: inherit; }
  </style>
</head>
<body>
  <h1>æˆ‘ä»¬çš„æ‹çˆ±æ—¥è®°</h1>
<section class="timer">
  <h2>çºªå¿µæ—¥å€’è®¡æ—¶</h2>
  <p id="daysTogether" style="font-size:1.2em; font-weight:bold;"></p>
  <p id="milestoneMessage" style="color:red; font-weight:bold;"></p>
  <p id="countdownMessage" style="color:purple; font-weight:bold;"></p>
</section>


  <section class="messages">
    <h2>ç•™è¨€æ¿</h2>
    <div id="messageList"></div>
    <textarea id="msgInput" placeholder="å†™ä¸‹ä»Šå¤©çš„å¿ƒæƒ…..." style="width:80%; padding:10px; border-radius:8px;"></textarea><br>
    <button onclick="addMessage()" style="margin-top:10px; padding:8px 12px; background:#ff69b4; color:white; border:none; border-radius:8px; cursor:pointer;">ğŸ’¬ æ·»åŠ ç•™è¨€</button>
  </section>

  <section class="gallery">
    <h2>ä¸Šä¼ æˆ‘ä»¬çš„ç…§ç‰‡</h2>
    <input type="file" id="photoUpload" accept="image/*">
    <button onclick="uploadPhoto()" style="margin-top:10px;">ğŸ“¤ ä¸Šä¼ ç…§ç‰‡</button>
    <div class="photo-grid" id="photoGrid"></div>
  
<section class="quiz">
  <h2>
<h3>ä¸Šä¼ æˆ‘ä»¬çš„ç…§ç‰‡</h3>
<input type="file" id="photoInput" accept="image/*">
<button onclick="uploadToCloudinary()">ä¸Šä¼ ç…§ç‰‡</button>
<p id="uploadStatus"></p>
<div id="photoGallery"></div>

<script>
  function loadSavedPhotos() {
    const gallery = document.getElementById('photoGallery');
    const savedPhotos = JSON.parse(localStorage.getItem('uploadedPhotos') || '[]');
    gallery.innerHTML = savedPhotos.map(url => `<img src="${url}" width="200" style="margin:10px">`).join('');
  }

  async function uploadToCloudinary() {
    const file = document.getElementById('photoInput').files[0];
    if (!file) {
      document.getElementById('uploadStatus').innerText = "è¯·å…ˆé€‰æ‹©ä¸€å¼ ç…§ç‰‡";
      return;
    }

    const formData = new FormData();
    formData.append("file", file);
    formData.append("upload_preset", "love_diary_upload");

    const response = await fetch("https://api.cloudinary.com/v1_1/dgyypvkar/image/upload", {
      method: "POST",
      body: formData
    });

    const data = await response.json();
    const url = data.secure_url;
    document.getElementById('uploadStatus').innerHTML = `ä¸Šä¼ æˆåŠŸï¼<br><img src="${url}" width="200">`;

    const savedPhotos = JSON.parse(localStorage.getItem('uploadedPhotos') || '[]');
    savedPhotos.push(url);
    localStorage.setItem('uploadedPhotos', JSON.stringify(savedPhotos));

    loadSavedPhotos();
  }

  window.onload = loadSavedPhotos;
</script>

æƒ…ä¾£äº’åŠ¨å°æ¸¸æˆ</h2>
  <p>ä½ ä»¬ç¬¬ä¸€æ¬¡çº¦ä¼šæ˜¯åœ¨å“ªä¸€å¤©ï¼Ÿ</p>
  <input type="text" id="quizAnswer" placeholder="è¯·è¾“å…¥ç­”æ¡ˆ...">
  <button onclick="checkAnswer()">æäº¤ç­”æ¡ˆ</button>
  <p id="quizResult" style="font-weight:bold; color:green;"></p>
</section>


  <section class="playlist">
    <h2>æˆ‘ä»¬çš„æ­Œå•</h2>
    <iframe id="musicPlayer" src="" allowfullscreen></iframe>
    <div style="margin-top:10px;">
      <button onclick="prevSong()" style="padding:8px 15px; border:none; border-radius:8px; background:#ff99cc; color:white; font-weight:bold; cursor:pointer;">â® ä¸Šä¸€é¦–</button>
      <button onclick="nextSong()" style="padding:8px 15px; border:none; border-radius:8px; background:#ff99cc; color:white; font-weight:bold; cursor:pointer;">â­ ä¸‹ä¸€é¦–</button>
    </div>
    <p id="songTitle" style="margin-top:10px; font-weight:bold; color:#e91e63;"></p>
    <input type="text" id="songInput" placeholder="ç²˜è´´ YouTube é“¾æ¥..." style="width:70%; padding:8px; border:1px solid #ccc; border-radius:8px;">
    <button onclick="addSong()" style="padding:8px 12px; border:none; border-radius:8px; background:#4caf50; color:white; font-weight:bold; cursor:pointer;">â• æ·»åŠ æ­Œæ›²</button>
    <ul id="playlist" style="margin-top:20px; list-style:none; padding:0; text-align:left;"></ul>
  </section>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAR7AMXeT9_uplzWWqmp2aRq6en0a0DqWs",
      authDomain: "love-diary-409ba.firebaseapp.com",
      projectId: "love-diary-409ba",
      storageBucket: "love-diary-409ba.appspot.com",
      messagingSenderId: "167600122208",
      appId: "1:167600122208:web:faddd3abddfcbab0039605"
    };

    const app = firebase.initializeApp(firebaseConfig);
    const storage = firebase.storage();

    function uploadPhoto() {
      const fileInput = document.getElementById("photoUpload");
      const file = fileInput.files[0];
      if (!file) return alert("è¯·é€‰æ‹©ç…§ç‰‡");
      const storageRef = storage.ref("photos/" + file.name);
      storageRef.put(file).then(snapshot => {
        snapshot.ref.getDownloadURL().then(url => {
          const img = document.createElement("img");
          img.src = url;
          img.alt = "æƒ…ä¾£ç…§ç‰‡";
          document.getElementById("photoGrid").appendChild(img);
        });
      }).catch(error => {
        console.error("ä¸Šä¼ å¤±è´¥", error);
        alert("ä¸Šä¼ å¤±è´¥ï¼Œè¯·ç¨åå†è¯•");
      });
    }

    let messages = [];
    function saveMessagesToLocal() {
      localStorage.setItem("loveMessages", JSON.stringify(messages));
    }
    function loadMessagesFromLocal() {
      const stored = localStorage.getItem("loveMessages");
      if (stored) messages = JSON.parse(stored);
    }
    function renderMessages() {
      const container = document.getElementById("messageList");
      container.innerHTML = messages.map(m => `<div class='msg'>${m}</div>`).join("");
    }
    function addMessage() {
      const input = document.getElementById("msgInput").value.trim();
      if (!input) return alert("è¯·è¾“å…¥ç•™è¨€å†…å®¹");
      messages.push(input);
      saveMessagesToLocal();
      renderMessages();
      document.getElementById("msgInput").value = "";
    }

    let songs = [];
    let currentSong = 0;
    function saveSongsToLocal() {
      localStorage.setItem("loveSongs", JSON.stringify(songs));
    }
    function loadSongsFromLocal() {
      const stored = localStorage.getItem("loveSongs");
      if (stored) songs = JSON.parse(stored);
    }
    function renderPlaylist() {
      const playlist = document.getElementById("playlist");
      playlist.innerHTML = "";
      songs.forEach((song, index) => {
        const li = document.createElement("li");
        li.textContent = song.title;
        li.style.padding = "8px";
        li.style.cursor = "pointer";
        li.style.borderBottom = "1px solid #ddd";
        li.onclick = () => {
          currentSong = index;
          loadSong(currentSong);
        };
        playlist.appendChild(li);
      });
      highlightCurrentSong();
    }
    function highlightCurrentSong() {
      const items = document.querySelectorAll("#playlist li");
      items.forEach((li, index) => {
        li.style.background = (index === currentSong) ? "#ffe6f0" : "transparent";
        li.style.fontWeight = (index === currentSong) ? "bold" : "normal";
      });
    }
    function loadSong(index) {
      const player = document.getElementById("musicPlayer");
      player.src = "https://www.youtube.com/embed/" + songs[index].id + "?autoplay=1";
      document.getElementById("songTitle").textContent = "æ­£åœ¨æ’­æ”¾ï¼š" + songs[index].title;
      highlightCurrentSong();
    }
    async function fetchYouTubeTitle(videoId) {
      try {
        const response = await fetch(`https://www.youtube.com/watch?v=${videoId}`);
        const text = await response.text();
        const match = text.match(/<title>(.*?)<\/title>/);
        if (match && match[1]) {
          return match[1].replace(" - YouTube", "").trim();
        }
      } catch (error) {
        console.error("è·å–æ ‡é¢˜å¤±è´¥", error);
      }
      return "ğŸ¶ æ–°æ­Œ";
    }
    async function addSong() {
      const input = document.getElementById("songInput").value.trim();
      if (!input) return alert("è¯·è¾“å…¥ YouTube é“¾æ¥");
      let videoId = "";
      if (input.includes("watch?v=")) {
        videoId = input.split("watch?v=")[1].split("&")[0];
      } else if (input.includes("youtu.be/")) {
        videoId = input.split("youtu.be/")[1].split("?")[0];
      } else if (input.includes("embed/")) {
        videoId = input.split("embed/")[1].split("?")[0];
      } else {
        return alert("é“¾æ¥æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·è¾“å…¥ YouTube è§†é¢‘é“¾æ¥");
      }
      const title = await fetchYouTubeTitle(videoId);
      const newSong = { id: videoId, title };
      songs.push(newSong);
      currentSong = songs.length - 1;
      saveSongsToLocal();
      renderPlaylist();
      loadSong(currentSong);
      document.getElementById("songInput").value = "";
    }

    loadMessagesFromLocal();
    renderMessages();
    loadSongsFromLocal();
    renderPlaylist();
    if (songs.length > 0) loadSong(currentSong);
  </script>

<script>
  function updateTimer() {
    const startDate = new Date("2024-09-01T00:00:00");
    const now = new Date();
    const diff = now - startDate;
    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
    document.getElementById("daysTogether").textContent = `æˆ‘ä»¬å·²ç»åœ¨ä¸€èµ· ${days} å¤©å•¦ ğŸ’•`;

    const milestones = [100, 200, 365, 520, 730, 1000];
    if (milestones.includes(days)) {
      document.getElementById("milestoneMessage").textContent = `ğŸ‰ ä»Šå¤©æ˜¯æˆ‘ä»¬åœ¨ä¸€èµ·çš„ç¬¬ ${days} å¤©ï¼ç‰¹åˆ«çš„æ—¥å­ï¼Œæ°¸è¿œçˆ±ä½  ğŸ’–`;
    } else {
      document.getElementById("milestoneMessage").textContent = "";
    }

    const years = Math.floor(days / 365);
    const nextAnniversary = new Date(startDate);
    nextAnniversary.setFullYear(startDate.getFullYear() + years + 1);
    const diffNext = nextAnniversary - now;
    const daysLeft = Math.ceil(diffNext / (1000 * 60 * 60 * 24));
    document.getElementById("countdownMessage").textContent = `ğŸ“… è·ç¦»æˆ‘ä»¬çš„ ${years + 1} å‘¨å¹´çºªå¿µæ—¥è¿˜æœ‰ ${daysLeft} å¤© ğŸ’œ`;
  }
  updateTimer();
  setInterval(updateTimer, 60000);
</script>


<script src="https://cdn.jsdelivr.net/gh/mikecao/leaflet-sakura/sakura.min.js"></script>
<script>
  window.onload = function() {
    new Sakura('body');
  };
</script>


<script>
  function checkAnswer() {
    const answer = document.getElementById("quizAnswer").value.trim();
    const correct = "2024å¹´9æœˆ1æ—¥";
    const result = document.getElementById("quizResult");
    if (answer === correct) {
      result.textContent = "ç­”å¯¹å•¦ï¼ä½ ä»¬çœŸæœ‰é»˜å¥‘ ğŸ’–";
    } else {
      result.textContent = "å†æƒ³æƒ³å“¦ï¼Œæç¤ºï¼šçºªå¿µæ—¥ï¼";
    }
  }
</script>


<script>
  function showAnniversaryNotification() {
    const startDate = new Date("2024-09-01T00:00:00");
    const now = new Date();
    const diff = now - startDate;
    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
    const milestones = [100, 200, 365, 520, 730, 1000];

    if (milestones.includes(days)) {
      if (Notification.permission === "granted") {
        new Notification("çºªå¿µæ—¥æé†’", {
          body: `ä»Šå¤©æ˜¯æˆ‘ä»¬åœ¨ä¸€èµ·çš„ç¬¬ ${days} å¤©ï¼æ°¸è¿œçˆ±ä½  ğŸ’–`,
          icon: "https://cdn-icons-png.flaticon.com/512/833/833472.png"
        });
      } else if (Notification.permission !== "denied") {
        Notification.requestPermission().then(permission => {
          if (permission === "granted") {
            new Notification("çºªå¿µæ—¥æé†’", {
              body: `ä»Šå¤©æ˜¯æˆ‘ä»¬åœ¨ä¸€èµ·çš„ç¬¬ ${days} å¤©ï¼æ°¸è¿œçˆ±ä½  ğŸ’–`,
              icon: "https://cdn-icons-png.flaticon.com/512/833/833472.png"
            });
          }
        });
      }
    }
  }
  showAnniversaryNotification();
</script>

</body>
</html>
